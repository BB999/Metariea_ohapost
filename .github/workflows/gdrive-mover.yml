name: Google Drive Mover

on:
  workflow_call:
    inputs:
      source-path:
        description: 'ç§»å‹•å…ƒã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ‘ã‚¹'
        required: true
        type: string
      image-name:
        description: 'ç§»å‹•ã™ã‚‹ç”»åƒå'
        required: true
        type: string
      dest-path:
        description: 'ç§»å‹•å…ˆã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ‘ã‚¹'
        required: true
        type: string
      next-number:
        description: 'æ›´æ–°ã™ã‚‹ç•ªå·'
        required: true
        type: string

permissions:
  contents: write

jobs:
  move-image:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install rclone
      run: |
        curl https://rclone.org/install.sh | sudo bash

    - name: Setup rclone config
      run: |
        mkdir -p ~/.config/rclone
        echo "${{ secrets.RCLONE_CONF_BASE64 }}" | base64 -d > ~/.config/rclone/rclone.conf

    - name: Move image to destination
      run: |
        DATE=$(date +%Y-%m-%d)
        SOURCE="${{ inputs.source-path }}${{ inputs.image-name }}"
        DEST="${{ inputs.dest-path }}${DATE}_${{ inputs.image-name }}"

        echo "ğŸ“¦ Moving: $SOURCE"
        echo "ğŸ“ To: $DEST"

        # ã‚³ãƒ”ãƒ¼ã—ã¦ã‹ã‚‰å‰Šé™¤ï¼ˆmoveãŒã†ã¾ãã„ã‹ãªã„å ´åˆã®å¯¾ç­–ï¼‰
        rclone copyto "$SOURCE" "$DEST"
        rclone delete "$SOURCE"

        echo "âœ… ç”»åƒç§»å‹•å®Œäº†!"

    - name: Update previous number
      run: |
        echo "${{ inputs.next-number }}" > "previous file"
        cat "previous file"

    - name: Commit and push
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add "previous file"
        DATE=$(date +%Y-%m-%d)
        git commit -m "[$DATE] Update previous number to ${{ inputs.next-number }}"
        git push
        echo "âœ… ç•ªå·æ›´æ–°å®Œäº†!"
